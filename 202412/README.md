# 那些年用過的 Git 分支管理策略

- [活動連結](https://www.facebook.com/events/7444604432330852/)
- [投影片](https://hackmd.io/P78xVpNaTxCNaEvUITQ4XQ?view)

## 1. Git Flow：經典且結構化的流程

Git Flow 是最早被廣泛採用的分支策略之一，定義了非常明確的分支職責，適合版本發布週期固定且較長的大型專案。

### 核心分支結構
*   **Master (Main)**: 隨時保持可部署狀態的生產環境代碼。
*   **Develop**: 主要開發分支，集結所有開發中的功能。
*   **Feature**: 從 Develop 分支出來，開發特定新功能，完成後合併回 Develop。
*   **Release**: 準備發布新版本時從 Develop 分出，進行最後測試與修復，完成後合併回 Master 與 Develop。
*   **Hotfix**: 當生產環境 (Master) 出現緊急 Bug 時，直接從 Master 分修復分支，修復後合併回 Master 與 Develop。

### 優缺點分析
*   ✅ **優點**：架構清晰，適合需要同時維護多個版本的團隊。因為非常普及，大部分的團隊成員都熟悉這套做法，這也是它流行的重要原因。
*   ❌ **缺點**：流程繁瑣，長期維護多個分支（Master/Develop）容易造成混淆。對於需要快速迭代（如每天部署多次）的專案來說過於沈重。

---

## 2. GitHub Flow：輕量級與快速迭代

GitHub Flow 是為了適應持續部署（Continuous Deployment）而簡化的流程，核心理念是「Master 分支永遠是可部署的」。

### 核心流程
1.  從 Master 開出新分支進行開發。
2.  提交變更 (Commit)。
3.  發起 Pull Request (PR) 進行討論與審查。
4.  通過審查並測試後，直接合併回 Master 並部署。

### 優缺點分析
*   ✅ **優點**：極度簡單，非常適合小型團隊或 Web 服務等需要快速迭代的專案。
*   ❌ **缺點**：缺乏明確的 Release 管理機制，無法同時維護多個舊版本（如 v1.0, v2.0）。如果部署頻率極高，對測試覆蓋率與自動化部署的要求也很高。

---

## 3. GitLab Flow：折衷與環境整合

GitLab Flow 試圖在 Git Flow 的結構性與 GitHub Flow 的簡單性之間取得平衡，並引入了「環境分支（Environment Branches）」或「發布分支（Release Branches）」的概念。

### 核心變體
1.  **環境分支型**：除了 Master (Staging)，另外維護 `production` 分支。代碼先合併進 Master 測試，確認無誤後再從 Master 合併到 Production 分支進行部署。
2.  **版本分支型**：針對軟體產品，允許從 Master 開出穩定的 `release` 分支（如 `2-3-stable`）進行維護。

### 優缺點分析
*   ✅ **優點**：比 Git Flow 簡單，但比 GitHub Flow 更能適應複雜的部署環境或多版本需求。
*   ❌ **缺點**：相較 GitHub Flow 仍多了一層管理成本。

---

## 4. Kitware 策略 (ENV Branching)：環境驅動開發

這是一種將分支與部署環境（Environment）緊密掛鉤的策略，強調功能開發的獨立性與環境驗證的關卡。

### 核心流程
1.  **Feature 分支**：所有的功能開發都直接從 **Main** 分支出來。
2.  **測試驗證**：開發完成後，將 Feature 分支合併進 **Develop** 或 **Staging** 分支進行測試。
    *   *注意：Develop/Staging 分支僅作為測試環境的集成點，不直接 merge 回 Main。*
3.  **發布上線**：只有在測試環境驗證通過的 Feature 分支，才會被合併回 **Main** 進行正式發布。

### 優缺點分析
*   ✅ **優點**：
    *   **功能獨立**：可以選擇性地上線特定功能（Cherry-pick 概念），不受其他功能開發進度影響。
    *   **環境隔離**：測試壞掉的代碼不會污染主線。
*   ❌ **缺點**：
    *   **管理複雜**：開發者需要清楚知道目前的變更在哪個分支、哪個環境。
    *   **衝突風險**：如果測試分支 (Develop) 與主線 (Main) 差異過大，測試結果可能失真，導致「在測試環境沒問題，上線卻壞掉」的情況。

---

## 5. Trunk Based Development (TBD)：主幹開發

> 註：其實目前尚未實際運行此策略，但將其視為這間公司的未來目標。目前正致力於提升測試覆蓋率。

主幹開發是現代敏捷開發（Agile）與 DevOps 推崇的終極目標。所有開發者都在同一個主幹（Trunk/Main）上頻繁提交代碼。

### 核心理念
*   **單一主幹**：幾乎沒有長期存在的 Feature 分支。
*   **頻繁提交**：開發者每天多次將代碼合併回主幹。
*   **依賴自動化**：必須擁有強大的自動化測試體系來確保主幹隨時可用。


### 優缺點分析
*   ✅ **優點**：
    *   **避免合併地獄 (Merge Hell)**：因為差異小，衝突極少。
    *   **極速回饋**：問題能被即時發現與修復。
    *   符合 MVP (Minimum Viable Product) 開發精神。
*   ❌ **缺點**：
    *   **門檻極高**：需要極高的測試覆蓋率與資深的團隊協作能力。
    *   **無法手動回歸測試**：必須依賴自動化測試。

---

## 其他重要 Tip

除了分支策略本身，還有兩個關鍵實踐：

### 1. Feature Toggles (功能開關)
**Feature Toggles** 是解決長週期功能開發與頻繁整合衝突的不可或缺技術。當一個功能開發尚未完成，但我需要合併代碼回主幹時，可以將未完成的代碼用 `if (feature_enabled) { ... }` 包起來，如此一來：
    *   代碼可以隨時合併進主幹 (Main)。
    *   在生產環境中預設關閉該功能，待功能完成後即可開啟功能。

### 2. Code Review (Approved PR)
無論採用哪種分支策略，**Code Review** 都是預設且必要的環節。所有變更都應透過 Pull Request (PR) 提交，並在獲得批准 (Approved) 後才能合併。這確保了代碼品質與團隊成員間的知識共享。

---
本文由 Antigravity + Gemini 3 Pro 協助整理